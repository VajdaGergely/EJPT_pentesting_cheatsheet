# PEN 200 random notes
## NTLM PassTheHash (PtH) attack
* We can use this technique to authenticate to a local or remote target with a valid combination of username and NTLM hash rather than a plaintext password.
* This is possible because NTLM/LM password hashes are not salted and remain static between sessions.
* If we discover a password hash on one target, we can use it to not only authenticate to that target, but to another target as well, as long as the second target has an account with the same username and password.
* **To leverage this into code execution of any kind, the account also needs administrative privileges on the second target**.
* If we don’t use the local Administrator user in pass-the-hash, the target machine also needs to be configured in a certain way to obtain successful code execution.
  * Since Windows Vista, all Windows versions have UAC remote restrictions enabled by default. This prevents software or commands from running with administrative rights on remote systems.
* **It is quite common and is often found in real-life assessments that the local Administrator accounts have the same password on multiple machines!!!**
## Dumping creds from LSASS with mimikatz
* LSASS is important for us because it caches NTLM hashes and other credentials, which we can extract using the sekurlsa Mimikatz module. We need to understand that **LSASS runs under the SYSTEM user and is therefore even more privileged than a process started as Administrator**.
* Due to this, **we can only extract passwords if we are running Mimikatz as Administrator (or higher) and have the SeDebugPrivilege access right enabled**. This access right grants us the ability to debug not only processes we own, but also all other users’ processes.
* **We can also elevate our privileges to the SYSTEM account with tools like PsExec or the built-in Mimikatz token elevation function to obtain the required privileges**. The token elevation function requires the SeImpersonatePrivilege access right to work, but all local administrators have it by default.
