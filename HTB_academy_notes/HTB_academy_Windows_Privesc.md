# Hack The Box academy Windows Privilege Escalation notes
## Intro
Note: Depending on how we gain access to a system we may not have many directories that are writeable by our user to upload tools. It is always a safe bet to upload tools to C:\Windows\Temp because the BUILTIN\Users group has write access.  
## Situational Awareness
* Network Information
  * ipconfig /all, arp -a, route print
* Enumerating Protections
<pre>
# Check Windows Defender Status
Get-MpComputerStatus
# List AppLocker Rules
Get-AppLockerPolicy -Effective | select -ExpandProperty RuleCollections
# Test AppLocker Policy
Get-AppLockerPolicy -Local | Test-AppLockerPolicy -path C:\Windows\System32\cmd.exe -User Everyone
</pre>
## Initial Enumeration
### Intro
During an assessment, we may gain a low-privileged shell on a Windows host (domain-joined or not) and need to perform privilege escalation to further our access.  
We can escalate privileges to one of the following depending on the system configuration and what type of data we encounter:  
* The highly privileged **NT AUTHORITY\SYSTEM** account, or **LocalSystem** account which is a highly privileged account with more privileges than a local administrator account and is used to run most Windows services.
* The built-in local **administrator** account. Some organizations disable this account, but many do not. It is not uncommon to see this account reused across multiple systems in a client environment.
* Another local account that is a member of the local **Administrators** group. Any account in this group will have the same privileges as the built-in **administrator** account.
* A standard (non-privileged) domain user who is part of the local **Administrators** group.
* A domain admin (highly privileged in the Active Directory environment) that is part of the local **Administrators** group.
Windows Commands Reference
* Lists lots of manual enumeration tasks
* https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/windows-commands
**Key Data Points**
* OS name: Knowing the type of Windows OS (workstation or server) and level (Windows 7 or 10, Server 2008, 2012, 2016, 2019, etc.) will give us an idea of the types of tools that may be available (such as the PowerShell version, or lack thereof on legacy systems. This would also identify the operating system version for which there may be public exploits available.
* Version: As with the OS version, there may be public exploits that target a vulnerability in a specific version of Windows. Windows system exploits can cause system instability or even a complete crash. Be careful running these against any production system, and make sure you fully understand the exploit and possible ramifications before running one.
* Running Services: Knowing what services are running on the host is important, especially those running as NT AUTHORITY\SYSTEM or an administrator-level account. A misconfigured or vulnerable service running in the context of a privileged account can be an easy win for privilege escalation.
