# Hack The Box academy Linux Privilege Escalation notes
## Introduction to Linux Privilege Escalation
### Short list
* basic things to check
  * OS version, kernel version, running services
* basic commands
  * ps aux | grep root (root processes)
  * ps au (similar than ps aux)
  * ls -la /, ls -la /home, ls -la /home/user1, ls -la /home/user1/.ssh
  * history, sudo -l, crontab -l, cat /etc/*cron*, ls -la /etc/*cron*
  * cat /etc/passwd, cat /etc/shadow
  * lsblk (Unmounted File Systems and Additional Drives)
  * setuid-, setgid permissions
  * writeable directories
    * find / -path /proc -prune -o -type d -perm -o+w 2>/dev/null
  * writeable files
    * find / -path /proc -prune -o -type f -perm -o+w 2>/dev/null
### some detailed info
* OS Version: Knowing the distribution (Ubuntu, Debian, FreeBSD, Fedora, SUSE, Red Hat, CentOS, etc.) will give you an idea of the types of tools that may be available. This would also identify the operating system version, for which there may be public exploits available.
* Kernel Version: As with the OS version, there may be public exploits that target a vulnerability in a specific kernel version. Kernel exploits can cause system instability or even a complete crash. Be careful running these against any production system, and make sure you fully understand the exploit and possible ramifications before running one.
* Running Services: Knowing what services are running on the host is important, especially those running as root. A misconfigured or vulnerable service running as root can be an easy win for privilege escalation. Flaws have been discovered in many common services such as Nagios, Exim, Samba, ProFTPd, etc. Public exploit PoCs exist for many of them, such as CVE-2016-9566, a local privilege escalation flaw in Nagios Core < 4.2.4.
## Environment Enumeration
* whoami, id, hostname, ifconfig (or ip a), sudo -l
* cat /etc/os-release (new or old linux system is used?) (if old, maybe it has known vulnerabilities)
* echo $PATH
* env
* uname -a (or cat /proc/version) (kernel version)
* lscpu (CPU type and version)
* cat /etc/shells (what shells are available?) (tmux and screen could be vulnerable!!)
* during enumeration we should note any defense system we found
  * e.g.: Exec Shield, iptables, AppArmor, SELinux, Fail2ban, Snort, Uncomplicated Firewall (ufw)
  * enumerating these systems not always works (because the lack of privileges)
  * but knowing them exist can help our strategy (not to test things that has extra defense...)
* lsblk (list hard disks, USB drives, optical drives, etc.)
* lpstat (printers)
* cat /etc/fstab (mounted and unmounted drives)
* route (or netstat -rn) (routing tables)
* /etc/resolv.conf (dns information) (important in domain environment !!!)
* arp -a
* cat /etc/passwd, cat /etc/shadow, cat /etc/group
* cat /etc/passwd | grep "*sh$" (users with shell)
  * some shell version is vulnerable (like bash v4.1 is vulnerable to shellshock)
* getent group group_name1 (lists members of a group)
* check the content of folders in home folders
* check configuration files
  * ends with .conf or .config
  * grep for usernames, passwords, credentials, secrets, ...
* if we found passwords we should try them for all users - maybe it will be working with one of them
* mounting and unmounting filesystems
  * by default it needs root priv to mount and umount file systems
    * for lateral movement the root access is the key to check everything to move on to the next system
* df -h (list mounted file systems)
* cat /etc/fstab | grep -v "#" | column -t (view unmounted file systems)
* find / -type f -name ".*" -exec ls -l {} \; 2>/dev/null | grep user1 (list all hidden files)
* find / -type d -name ".*" -ls 2>/dev/null (list all hidden directories)
* temporary directories
  * /tmp, /var/tmp
  * all users can read the contents of these folders (by default)
* ls -l /tmp /var/tmp /dev/shm (list temporary files)
## Linux Services & Internals Enumeration


